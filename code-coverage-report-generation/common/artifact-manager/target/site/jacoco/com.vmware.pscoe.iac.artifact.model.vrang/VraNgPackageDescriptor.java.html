<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VraNgPackageDescriptor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">artifact-manager</a> &gt; <a href="index.source.html" class="el_package">com.vmware.pscoe.iac.artifact.model.vrang</a> &gt; <span class="el_source">VraNgPackageDescriptor.java</span></div><h1>VraNgPackageDescriptor.java</h1><pre class="source lang-java linenums">package com.vmware.pscoe.iac.artifact.model.vrang;

/*
 * #%L
 * artifact-manager
 * %%
 * Copyright (C) 2023 VMware
 * %%
 * Build Tools for VMware Aria
 * Copyright 2023 VMware, Inc.
 * 
 * This product is licensed to you under the BSD-2 license (the &quot;License&quot;). You may not use this product except in compliance with the BSD-2 License.  
 * 
 * This product may include a number of subcomponents with separate copyright notices and license terms. Your use of these subcomponents is subject to the terms and conditions of the subcomponent's license, as noted in the LICENSE file.
 * #L%
 */

import java.io.File;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang3.builder.ReflectionToStringBuilder;
import org.apache.commons.lang3.builder.ToStringStyle;

import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.PropertyNamingStrategy;
import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;
import com.vmware.pscoe.iac.artifact.model.PackageContent.Content;
import com.vmware.pscoe.iac.artifact.model.PackageDescriptor;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

<span class="fc" id="L37">public class VraNgPackageDescriptor extends PackageDescriptor {</span>
	/**
	 * List of catalogItems.
	 */
    private List&lt;String&gt; catalogItem;
	/**
	 * List of blueprints.
	 */
    private List&lt;String&gt; blueprint;
	/**
	 * List of subscriptions.
	 */
    private List&lt;String&gt; subscription;
	/**
	 * List of flavorMappings.
	 */
    private List&lt;String&gt; flavorMapping;
	/**
	 * List of imageMappings.
	 */
    private List&lt;String&gt; imageMapping;
	/**
	 * List of storageProfiles.
	 */
    private List&lt;String&gt; storageProfile;
	/**
	 * List of catalogEntitlements.
	 */
    private List&lt;String&gt; catalogEntitlement;
	/**
	 * List of propertyGroups.
	 */
    private List&lt;String&gt; propertyGroup;
	/**
	 * List of regionMappings.
	 */
    private VraNgRegionMapping regionMapping;
	/**
	 * List of customResources.
	 */
    private List&lt;String&gt; customResource;
	/**
	 * List of resourceActions.
	 */
    private List&lt;String&gt; resourceAction;
	/**
	 * List of contentSources.
	 */
    private List&lt;String&gt; contentSource;
	/**
	 * Container for lists of policies for each policy type.
	 */
	private VraNgPolicy policy;
	/**
	 * Logger variable.
	 */
<span class="fc" id="L93">	private final Logger logger = LoggerFactory.getLogger(VraNgPackageDescriptor.class);</span>

	/**
	 * Getter.
	 * @return propertyGroup list.
	 */
	public List&lt;String&gt; getPropertyGroup() {
<span class="nc" id="L100">		return this.propertyGroup;</span>
	}

	/**
	 * Setter.
	 * @param propertyGroup input values.
	 */
	public void setPropertyGroup(List&lt;String&gt; propertyGroup) {
<span class="nc" id="L108">		this.propertyGroup	= propertyGroup;</span>
<span class="nc" id="L109">	}</span>

	/**
	 * Getter.
	 * @return blueprints.
	 */

    public List&lt;String&gt; getBlueprint() {
<span class="nc" id="L117">        return this.blueprint;</span>
    }

	/**
	 * Setter.
	 * @param blueprint input values.
	 */
    public void setBlueprint(List&lt;String&gt; blueprint) {
<span class="nc" id="L125">        this.blueprint = blueprint;</span>
<span class="nc" id="L126">    }</span>

	/**
	 * Getter.
	 * @return catalogItems.
	 */
    public List&lt;String&gt; getCatalogItem() {
<span class="nc" id="L133">        return this.catalogItem;</span>
    }

	/**
	 * Setter.
	 * @param catalogItem input values.
	 */
    public void setCatalogItem(List&lt;String&gt; catalogItem) {
<span class="nc" id="L141">        this.catalogItem = catalogItem;</span>
<span class="nc" id="L142">    }</span>

	/**
	 * Getter.
	 * @return subscriptions.
	 */
    public List&lt;String&gt; getSubscription() {
<span class="nc" id="L149">        return this.subscription;</span>
    }

	/**
	 * Setter.
	 * @param subscription input values.
	 */
    public void setSubscription(List&lt;String&gt; subscription) {
<span class="nc" id="L157">        this.subscription = subscription;</span>
<span class="nc" id="L158">    }</span>

	/**
	 * Getter.
	 * @return flavor mappings.
	 */
    public List&lt;String&gt; getFlavorMapping() {
<span class="nc" id="L165">        return this.flavorMapping;</span>
    }

	/**
	 * Setter.
	 * @param flavorMapping input values.
	 */
    public void setFlavorMapping(List&lt;String&gt; flavorMapping) {
<span class="nc" id="L173">        this.flavorMapping = flavorMapping;</span>
<span class="nc" id="L174">    }</span>

	/**
	 * Getter.
	 * @return image mappings.
	 */
    public List&lt;String&gt; getImageMapping() {
<span class="nc" id="L181">        return this.imageMapping;</span>
    }

	/**
	 * Setter.
	 * @param imageMapping input values.
	 */
    public void setImageMapping(List&lt;String&gt; imageMapping) {
<span class="nc" id="L189">        this.imageMapping = imageMapping;</span>
<span class="nc" id="L190">    }</span>

	/**
	 * Getter.
	 * @return storage profiles.
	 */
    public List&lt;String&gt; getStorageProfile() {
<span class="nc" id="L197">        return this.storageProfile;</span>
    }

	/**
	 * Setter.
	 * @param storageProfile input values.
	 */
    public void setStorageProfile(List&lt;String&gt; storageProfile) {
<span class="nc" id="L205">        this.storageProfile = storageProfile;</span>
<span class="nc" id="L206">    }</span>

	/**
	 * Getter.
	 * @return region mappings.
	 */
    public VraNgRegionMapping getRegionMapping() {
<span class="nc" id="L213">        return this.regionMapping;</span>
    }

	/**
	 * Setter.
	 * @param regionMapping input values.
	 */
    public void setRegionMapping(VraNgRegionMapping regionMapping) {
<span class="nc" id="L221">        this.regionMapping = regionMapping;</span>
<span class="nc" id="L222">    }</span>

	/**
	 * Getter.
	 * @return catalog entitlements.
	 */
    public List&lt;String&gt; getCatalogEntitlement() {
<span class="nc" id="L229">        return catalogEntitlement;</span>
    }

	/**
	 * Setter.
	 * @param catalogEntitlement input values.
	 */
    public void setCatalogEntitlement(List&lt;String&gt; catalogEntitlement) {
<span class="nc" id="L237">        this.catalogEntitlement = catalogEntitlement;</span>
<span class="nc" id="L238">    }</span>

	/**
	 * Getter.
	 * @return policy container.
	 */
	public VraNgPolicy getPolicy() {
<span class="nc" id="L245">        return this.policy;</span>
    }

	/**
	 * Setter.
	 * @param policy input value.
	 */
	public void setPolicy(VraNgPolicy policy) {
<span class="nc" id="L253">        logger.info(&quot;VraNgPolicy.setPolicy {}&quot;, policy);</span>
<span class="nc" id="L254">		this.policy = policy;</span>
<span class="nc" id="L255">    }</span>

	/**
	 * Getter.
	 * @return customResources.
	 */
    public List&lt;String&gt; getCustomResource() {
<span class="nc" id="L262">        return this.customResource;</span>
    }

	/**
	 * Setter.
	 * @param customResource input values.
	 */
    public void setCustomResource(List&lt;String&gt; customResource) {
<span class="nc" id="L270">        this.customResource = customResource;</span>
<span class="nc" id="L271">    }</span>

	/**
	 * Getter.
	 * @return resource actions.
	 */
    public List&lt;String&gt; getResourceAction() {
<span class="nc" id="L278">        return this.resourceAction;</span>
    }

	/**
	 * Setter.
	 * @param resourceAction input values.
	 */
    public void setResourceAction(List&lt;String&gt; resourceAction) {
<span class="nc" id="L286">        this.resourceAction = resourceAction;</span>
<span class="nc" id="L287">    }</span>

	/**
	 * Getter.
	 * @return Content sources.
	 */
    public List&lt;String&gt; getContentSource() {
<span class="nc" id="L294">        return contentSource;</span>
    }

	/**
	 * Setter.
	 * @param contentSource input values.
	 */
    public void setContentSource(List&lt;String&gt; contentSource) {
<span class="nc" id="L302">        this.contentSource = contentSource;</span>
<span class="nc" id="L303">    }</span>

	/**
	 * Getter.
	 *
	 * @param type VraNgPackageMemberType
	 * @return list of members of specific type.
	 */
    public List&lt;String&gt; getMembersForType(VraNgPackageMemberType type) {
<span class="nc bnc" id="L312" title="All 12 branches missed.">        switch (type) {</span>
            case BLUEPRINT:
<span class="nc" id="L314">                return getBlueprint();</span>
            case SUBSCRIPTION:
<span class="nc" id="L316">                return getSubscription();</span>
            case FLAVOR_PROFILE:
<span class="nc" id="L318">                return getFlavorMapping();</span>
            case IMAGE_PROFILE:
<span class="nc" id="L320">                return getImageMapping();</span>
            case STORAGE_PROFILE:
<span class="nc" id="L322">                return getStorageProfile();</span>
            case CATALOG_ENTITLEMENT:
<span class="nc" id="L324">                return getCatalogEntitlement();</span>
            case PROPERTY_GROUP:
<span class="nc" id="L326">                return getPropertyGroup();</span>
            case CUSTOM_RESOURCE:
<span class="nc" id="L328">                return getCustomResource();</span>
            case RESOURCE_ACTION:
<span class="nc" id="L330">                return getResourceAction();</span>
            case CONTENT_SOURCE:
<span class="nc" id="L332">                return getContentSource();</span>
            case CATALOG_ITEM:
<span class="nc" id="L334">                return getCatalogItem();</span>
            // case REGION_MAPPING:
            // return getRegionMapping().stream().map(rm -&gt; {
            // rm.getCloudAccountTags().keySet();
            // }).collect(Collectors.toList());
            default:
<span class="nc" id="L340">                throw new RuntimeException(&quot;ContentType is not supported!&quot;);</span>
        }
    }

	/**
	 * List of values, filtered by  type.isNativeContent().
	 * @return list
	 */
    public boolean hasNativeContent() {
<span class="nc" id="L349">        return Arrays.stream(VraNgPackageMemberType.values())</span>
<span class="nc" id="L350">            .filter(type -&gt; type.isNativeContent())</span>
<span class="nc" id="L351">            .anyMatch(type -&gt; {</span>
<span class="nc" id="L352">                List&lt;String&gt; memberNames = this.getMembersForType(type);</span>
<span class="nc bnc" id="L353" title="All 4 branches missed.">                return memberNames != null &amp;&amp; !memberNames.isEmpty();</span>
            });
    }

	/**
	 * Create a VraNgPackageDescriptor instance from file.
	 * @param filesystemPath the file
	 * @return VraNgPackageDescriptor instance
	 */
    public static VraNgPackageDescriptor getInstance(File filesystemPath) {
<span class="nc" id="L363">        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());</span>
<span class="nc" id="L364">        mapper.setPropertyNamingStrategy(PropertyNamingStrategy.KEBAB_CASE);</span>
<span class="nc" id="L365">        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);</span>
        try {
<span class="nc" id="L367">            VraNgPackageDescriptor pkgDescriptor = mapper.readValue(filesystemPath, VraNgPackageDescriptor.class);</span>
<span class="nc" id="L368">            System.out.println(ReflectionToStringBuilder.toString(pkgDescriptor, ToStringStyle.MULTI_LINE_STYLE));</span>

<span class="nc" id="L370">            return pkgDescriptor;</span>
<span class="nc" id="L371">        } catch (Exception e) {</span>
<span class="nc" id="L372">            throw new RuntimeException(&quot;Unable to load vRA Package Descriptor[&quot; + filesystemPath.getAbsolutePath() + &quot;]&quot;, e);</span>
        }
    }

	/**
	 *  Create a VraNgPackageDescriptor instance from VraNgPackageContent instance.
	 * @param content the package content instance
	 * @return VraNgPackageDescriptor instance
	 */
    public static VraNgPackageDescriptor getInstance(VraNgPackageContent content) {
<span class="nc" id="L382">        Map&lt;VraNgPackageContent.ContentType, List&lt;String&gt;&gt; map = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">        for (VraNgPackageContent.ContentType type : VraNgPackageContent.ContentType.values()) {</span>
<span class="nc" id="L384">            map.put(type, new ArrayList&lt;&gt;());</span>
        }

<span class="nc bnc" id="L387" title="All 2 branches missed.">        for (Content c : content.getContent()) {</span>
<span class="nc" id="L388">            map.get(c.getType()).add(c.getName());</span>
<span class="nc" id="L389">        }</span>

<span class="nc" id="L391">        VraNgPackageDescriptor pd = new VraNgPackageDescriptor();</span>
<span class="nc" id="L392">        pd.blueprint = map.get(VraNgPackageContent.ContentType.BLUEPRINT);</span>
<span class="nc" id="L393">        pd.subscription = map.get(VraNgPackageContent.ContentType.SUBSCRIPTION);</span>
<span class="nc" id="L394">        pd.flavorMapping = map.get(VraNgPackageContent.ContentType.FLAVOR_MAPPING);</span>
<span class="nc" id="L395">        pd.imageMapping = map.get(VraNgPackageContent.ContentType.IMAGE_MAPPING);</span>
<span class="nc" id="L396">        pd.storageProfile = map.get(VraNgPackageContent.ContentType.STORAGE_PROFILE);</span>
<span class="nc" id="L397">        pd.catalogEntitlement = map.get(VraNgPackageContent.ContentType.CATALOG_ENTITLEMENT);</span>
<span class="nc" id="L398">        pd.customResource = map.get(VraNgPackageContent.ContentType.CUSTOM_RESOURCE);</span>
<span class="nc" id="L399">        pd.resourceAction = map.get(VraNgPackageContent.ContentType.RESOURCE_ACTION);</span>
<span class="nc" id="L400">        pd.contentSource = map.get(VraNgPackageContent.ContentType.CONTENT_SOURCE);</span>
<span class="nc" id="L401">        pd.catalogItem = map.get(VraNgPackageContent.ContentType.CATALOG_ITEM);</span>
<span class="nc" id="L402">        pd.propertyGroup = map.get(VraNgPackageContent.ContentType.PROPERTY_GROUP);</span>
		//pd.policy = map.get(VraNgPackageContent.ContentType.POLICY);

        // System.out.println(&quot;REGION MAPPINGS ------&quot;);
        // map.get(VraNgPackageContent.ContentType.REGION_MAPPING).forEach(e -&gt; {
        //     System.out.println(e);
        // });
        // pd.regionMapping = map.get(VraNgPackageContent.ContentType.REGION_MAPPING);

<span class="nc" id="L411">        return pd;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>